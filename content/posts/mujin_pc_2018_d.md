---
title: "Mujin Programming Challenge 2018 D うほょじご"
date: 2020-05-07T10:23:10+09:00
draft: false
toc: false
images:
tags:
  - untagged
---

色々解法を思いついたので書いてみる。

<a href="https://atcoder.jp/contests/mujin-pc-2018/tasks/mujin_pc_2018_d" target="_blank">問題</a>

# 概要

$X:=\\{\ 0$以上$1000$未満の整数$\ \\}$ とする。

正の整数 $n$、$m<1000$ が与えられる。問題文で定義される $f:X \times X\rightarrow X \times X$ について、次を満たす $(p,q) \in X \times X$ の個数を求めよ。

- $1 \leq p \leq n$, $1 \leq q \leq m$
- $(p,q)$ に $f$ を繰り返し施しても第一成分、第二成分いずれも$0$にならない。

# 解法 1(解説の方法)

$f$ を繰り返し施したとき第一成分、第二成分どちらかが 0 になるものを数えてもよい。これを数えるには $X \times X$ の元全体を頂点とするグラフに操作 $f$ から誘導される有向辺を張り、その辺に沿って移動したときにいつか $(0,k)$ か $(k,0)$ になるものを数えればいい。これは $f$ から誘導される辺とは逆向きの辺を張って $(0,k)$ と $(k,0)$ から BFS をすれば調べられる。

実装上は$p$、$q$ いずれかが 0 のとき$f(p,q)=(0,0)$と定義して$(0,0)$から BFS するのが楽。

# 解法 2 (union-find)

$p$、$q$ いずれかが 0 のとき $f(p,q)=(0,0)$ としておく。

この問題は次のように言い換えられる。

- $X \times X$の元を次の 2 つのグループに分けよ。
  1. $f$ を繰り返し施しても $(0,0)$ にならない。
  1. $f$ を繰り返し施したときいつか $(0, 0)$ になる。

次が成り立つ。

**主張 1**

- 任意の$ (p,q) \in X \times X$ について、$(p,q)$ と $f(p,q)$ は同じグループに属する。
- $(p',q')$ が 2 のグループに属することは、全ての $(p,q)$ について $(p,q)$ と $f(p,q)$ を union-find で繋いだときに $(p',q')$ が $(0,0)$ と同じグループになることと同値である。

よって $(p,q)$ と $f(p,q)$ を union-find で繋いでいき、$(0,0)$ と同値になるものを数えればいい。

<a href="https://atcoder.jp/contests/mujin-pc-2018/submissions/12905331" target="_blank">ソースコード</a>

# 解法 3(ダブリング)

問題文で問われているものの個数を直接数えることもできる。ここでも $p$、$q$ いずれかが 0 のとき$f(p,q)=(0,0)$ としておく。また $f$ の $k$ 回繰り返しを $f^k$ で表記する。

次が成り立つ。

**主張 2**

- $(p,q)$ に $f$ を何回施しても $(0,0)$ にならないことは、 $(p,q)$ に $f$ を 1000000($=|X \times X|$)回施しても $(0,0)$ にならないことと同値である。

よって各 $(p,q)$ について $f^{1000000}(p,q)$ を計算できればいいが、シンプルな方法では間に合わない。これはダブリングを使うことで $f^k$ を $O(\log\ k)$ で計算できる。具体的には、

1. $\text{doubling}[(p,q)][i]=f^{2^i}(p,q)$ となるようにテーブルを作成できればいい。
1. 愚直な計算で$\text{doubling}[(p,q)][0]$ は埋められる。
1. $\text{doubling}[(p,q)][i]=\text{doubling}[\text{doubling}[(p,q)][i-1]][i-1]$ とすればテーブルを高速に埋められる。

とすれば良い。

<a href="https://atcoder.jp/contests/mujin-pc-2018/submissions/12915255" target="_blank">ソースコード</a>
